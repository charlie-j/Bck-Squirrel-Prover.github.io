<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">

  <title>Squirrel Prover - Squirrel Prover</title>
  
  <link rel="stylesheet" href="style.css">
</head>

<body>
<span style="display: none;"><span class="input-line" id="in0">(*******************************************************************************
BASIC HASH

The Basic Hash protocol as described in [A] is an RFID protocol involving:
* a tag associated to a secret key;
* generic readers having access to a database containing all these keys.

The protocol is as follows:

T --&gt; R : &lt;nT, h(nT,key)&gt;
R --&gt; T : ok

In this file, we prove two security properties for this protocol.
* We first prove an **authentication** property for the reader 
(both for the then and the else branches).
* We then prove **unlinkability**, _i.e._ equivalence between a **real** system 
(where each tag can play multiple sessions) and an **ideal** system 
(where each tag plays only one session).

[A] Mayla Brusò, Kostas Chatzikokolakis, and Jerry den Hartog. Formal
Verification of Privacy for RFID Systems. pages 75–88, July 2010.
*******************************************************************************)
(**
When this option is set to `true`, Squirrel checks whether each tactic invoked
for the proof is also sound for quantum attackers.
**)
set postQuantumSound=true.</span><span class="output-line" id="out0">true
</span><span class="input-line" id="in1">

(** 
We start by declaring the function symbol `h` for the hash function,
as well as two public constants `ok` and `ko` (used by the reader). 
**)

hash h

abstract ok : message
abstract ko : message.</span><span class="output-line" id="out1"></span><span class="input-line" id="in2">

(** 
In order to model the real system and the ideal system, we will use two
different name symbols for the tags' secret keys.
The symbol `key` has index arity 1 and will be used in the real system, while
the symbol `key'` has index arity 2 and will be used in the ideal system
so that each new session of a tag uses a new key. 
**)

name key : index-&gt;message
name key' : index-&gt;index-&gt;message.</span><span class="output-line" id="out2"></span><span class="input-line" id="in3">

(** 
Finally, we declare the channels used by the protocol. 
**)

channel cT
channel cR.</span><span class="output-line" id="out3"></span><span class="input-line" id="in4">

(** 
The tag's role is modelled by the following process, indexed by `i` (for 
the identity of the tag) and by `k` (for the session of a given identity).
The tag starts by generating a fresh random name `nT`, then outputs a message 
built using `key(i)` in the real system and `key'(i,k)` in the ideal system.
**)

process tag(i:index,k:index) =
  new nT;
  out(cT, &lt;nT, h(nT,diff(key(i),key'(i,k)))&gt;).</span><span class="output-line" id="out4"></span><span class="input-line" id="in5">

(** 
The reader's role is modelled by the following process. Since readers are 
generic, the process is indexed only by `j` (for the session).
The reader starts by inputting a message `x` before checking whether this 
message corresponds to a legitimate output performed by a tag.
On the left side (the real system), the reader looks up for a key `key(i)`
in the database (the one corresponding to the tag of identity `i`).
On the right side (the ideal system), the reader looks up for a key `key(i,k`
in the database (the one used by the tag of identity `i` at session `k`).
**)

process reader(j:index) =
  in(cT,x);
  if exists (i,k:index), snd(x) = h(fst(x),diff(key(i),key'(i,k))) then
    out(cR,ok)
  else
    out(cR,ko).</span><span class="output-line" id="out5"></span><span class="input-line" id="in6">
    
(** 
The system is finally defined by putting an unbounded number of tag's and 
reader's processes in parallel.
This system is automatically translated to a set of actions:
* the initial action (`init`);
* one action for the tag (`T`);
* two actions for the reader, corresponding to the two branches of the 
conditional (respectively `R` and `R1`).
**)

system ((!_j R: reader(j)) | (!_i !_k T: tag(i,k))).</span><span class="output-line" id="out6">Un-processed system:
  
  (!_j R: <span class="pn" style="font-weight:bold; color: #0000AA">reader</span> j) | (!_i !_k T: <span class="pn" style="font-weight:bold; color: #0000AA">tag</span> i k)

Processed system:
  
  (!_j
     <span class="pio" style="font-weight: bold">in</span>(<span class="pc">cT</span>,<span class="pv" style="font-weight: bold; color: #AA00AA">x</span>);
     <span class="pc" style="text-decoration: underline; color: #AA0000">if</span> <span>exists</span> (i,k:index), snd(x) = h(fst(x),<span>diff</span>(key(i),key'(i,k))) <span class="pc" style="text-decoration: underline; color: #AA0000">then</span>
       R: <span class="pio" style="font-weight: bold">out</span>(<span class="pc">cR</span>,ok); <span class="pn" style="font-weight:bold; color: #0000AA">null</span> <span class="pc" style="text-decoration: underline; color: #AA0000">else</span> R1: <span class="pio" style="font-weight: bold">out</span>(<span class="pc">cR</span>,ko); <span class="pn" style="font-weight:bold; color: #0000AA">null</span>) |
  (!_i !_k T: <span class="pio" style="font-weight: bold">out</span>(<span class="pc">cT</span>,pair(nT(i,k),h(nT(i,k),<span>diff</span>(key(i),key'(i,k))))); <span class="pn" style="font-weight:bold; color: #0000AA">null</span>)

System default registered with actions (init,R,R1,T).
</span><span class="input-line" id="in7">

(**
This first authentication property is a reachability property expressed by a first-order
logic formula.
This property states that whenever a reader accepts a message (_i.e._ the 
condition of the action `R(j)` evaluates to `true`), then there must exists 
an action `T(i,k)` that was executed before the reader, and such that the input 
of the reader corresonds to the output of this tag (and conversely).
Note that we express this correspondence on each projection. Indeed, for some
implementations of the pairing primitive, the equality of projections does not imply
the equality of pairs.
**)

goal wa_R :
  forall (j:index),
    happens(R(j)) =&gt;
    (cond@R(j) &lt;=&gt;
      (exists (i,k:index), T(i,k) &lt; R(j) &amp;&amp;
       fst(output@T(i,k)) = fst(input@R(j)) &amp;&amp;
       snd(output@T(i,k)) = snd(input@R(j)))).</span><span class="output-line" id="out7">Goal wa_R :
  forall (j:index),
    (<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>) =&gt;
     (<span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R(j)</span> &lt;=&gt;
      exists (i,k:index),
        (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
         <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))]))
</span><span class="input-line" id="in8">
(**
The high-level idea of the proof is to use the EUF cryptographic axiom:
only the tag `T(i,k)` can forge `h(nT(i,k),key(i))` because the secret key 
is not known by the attacker.
Therefore, any message accepted by the reader must come from a tag that has 
played before.
The converse implication is trivial because any honest tag's output is
accepted by the reader.
**)
Proof.</span><span class="output-line" id="out8">[goal&gt; Focused goal (1/1):
System: default
<span class="sep" style="font-weight: bold">----------------------------------------</span>
forall (j:index),
  (<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>) =&gt;
   (<span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R(j)</span> &lt;=&gt;
    exists (i,k:index),
      (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
       <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))]))

</span><span class="input-line" id="in9">
  (** We start by introducing the variable `j` and the hypothesis 
  `happens(R(j))`, before unfolding the definiton of the `cond` macro,
  which corresponds to an existential quantification. **)
  intro j Hap.</span><span class="output-line" id="out9">[&gt; Line 130: (intro j Hap) 
[goal&gt; Focused goal (1/1):
System: default
Variables: j:index
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
<span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R(j)</span>
&lt;=&gt;
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))]

</span><span class="input-line" id="in10">
  expand cond.</span><span class="output-line" id="out10">[&gt; Line 131: (expand cond) 
[goal&gt; Focused goal (1/1):
System: default
Variables: j:index
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
(exists (i,k:index),
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k))))
&lt;=&gt;
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))]

</span><span class="input-line" id="in11">
  (** We have to prove two implications (`&lt;=&gt;`): we thus split the proof 
  in two parts. We now have two different goals to prove. **)
  split.</span><span class="output-line" id="out11">[&gt; Line 134: split 
[goal&gt; Focused goal (1/2):
System: default
Variables: i,j,k:index
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))

</span><span class="input-line" id="in12">
  (** For the first implication (=&gt;), we actually prove it separately for the 
  real system (left) and the ideal system (right). **)
  project.</span><span class="output-line" id="out12">[&gt; Line 137: project 
[goal&gt; Focused goal (1/3):
System: default/left
Variables: i,j,k:index
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>),<span class="gn" style="color: #AA5500">key</span>(i))
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))

</span><span class="input-line" id="in13">
  (** The proof is very similar on both sides and relies on the `euf` tactic.
  Applying the `euf` tactic on the `Meq` hypothesis generates a new hypothesis
  stating that `fst(input@R(j))` must be equal to some message that has
  already been hashed before.
  The only possibility is that this hash comes from the output of a tag that 
  has played before (thus the new hypothesis on timestamps). **)
  (* LEFT *) euf Meq.</span><span class="output-line" id="out13">[&gt; Line 144: (euf Meq) 
[goal&gt; Focused goal (1/3):
System: default/left
Variables: i,j,k,k0:index
Clt: <span class="ga" style="color: #00AA00">T(i,k0)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>),<span class="gn" style="color: #AA5500">key</span>(i))
Meq0: <span class="gn" style="color: #AA5500">nT</span>(i,k0) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))

</span><span class="input-line" id="in14"> by exists i,k0.</span><span class="output-line" id="out14">[&gt; Line 144: by (exists i, k0) 
[goal&gt; Focused goal (1/2):
System: default/right
Variables: i,j,k:index
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>),<span class="gn" style="color: #AA5500">key'</span>(i,k))
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))

</span><span class="input-line" id="in15">
  (* RIGHT *) euf Meq.</span><span class="output-line" id="out15">[&gt; Line 145: (euf Meq) 
[goal&gt; Focused goal (1/2):
System: default/right
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>),<span class="gn" style="color: #AA5500">key'</span>(i,k))
Meq0: <span class="gn" style="color: #AA5500">nT</span>(i,k) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))

</span><span class="input-line" id="in16"> by exists i,k.</span><span class="output-line" id="out16">[&gt; Line 145: by (exists i, k) 
[goal&gt; Focused goal (1/1):
System: default
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>))
D0: <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span> = &lt;<span class="gn" style="color: #AA5500">nT</span>(i,k),<span class="gf" style="font-weight: bold">h</span>(<span class="gn" style="color: #AA5500">nT</span>(i,k),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))&gt;
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>)
Meq0: <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))

</span><span class="input-line" id="in17">
  (** For the second implication (&lt;=), the conclusion of the goal can directly 
  be obtained from the hypotheses. **)
  by exists i,k.</span><span class="output-line" id="out17">[&gt; Line 148: by (exists i, k) 
[goal&gt; Goal wa_R is proved 
</span><span class="input-line" id="in18">
Qed.</span><span class="output-line" id="out18">Exiting proof mode.


</span><span class="input-line" id="in19">

(**
This second authentication property is the counterpart of the previous one,
but for the else branch of the reader.
This property states that whenever a reader **rejects** a message (_i.e._ the 
condition of the action `R1(j)` evaluates to `true`), then there does **not**
exist an action `T(i,k)` that was executed before the reader, and such that the 
input of the reader corresonds to the output of this tag (and conversely).
**)

goal wa_R1 :
  forall (j:index),
    happens(R1(j)) =&gt;
    cond@R1(j) &lt;=&gt;
    (not(exists (i,k:index), T(i,k) &lt; R1(j) &amp;&amp;
      fst(output@T(i,k)) = fst(input@R1(j)) &amp;&amp;
      snd(output@T(i,k)) = snd(input@R1(j)))).</span><span class="output-line" id="out19">Goal wa_R1 :
  forall (j:index),
    (<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>) =&gt;
     (<span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R1(j)</span> &lt;=&gt;
      not(exists (i,k:index),
            (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
             <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))]))
</span><span class="input-line" id="in20">
Proof.</span><span class="output-line" id="out20">[goal&gt; Focused goal (1/1):
System: default
<span class="sep" style="font-weight: bold">----------------------------------------</span>
forall (j:index),
  (<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>) =&gt;
   (<span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R1(j)</span> &lt;=&gt;
    not(exists (i,k:index),
          (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
           <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))]))

</span><span class="input-line" id="in21">
  intro *.</span><span class="output-line" id="out21">[&gt; Line 168: (intro *) 
[goal&gt; Focused goal (1/1):
System: default
Variables: j:index
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
<span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R1(j)</span>
&lt;=&gt;
not(exists (i,k:index),
      (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
       <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))]

</span><span class="input-line" id="in22">
  expand cond.</span><span class="output-line" id="out22">[&gt; Line 169: (expand cond) 
[goal&gt; Focused goal (1/1):
System: default
Variables: j:index
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
not(exists (i,k:index),
      <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k))))
&lt;=&gt;
not(exists (i,k:index),
      (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
       <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))]

</span><span class="input-line" id="in23">
  split.</span><span class="output-line" id="out23">[&gt; Line 170: split 
[goal&gt; Focused goal (1/2):
System: default
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
D0: <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span> = &lt;<span class="gn" style="color: #AA5500">nT</span>(i,k),<span class="gf" style="font-weight: bold">h</span>(<span class="gn" style="color: #AA5500">nT</span>(i,k),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))&gt;
H: not(exists (i,k:index),
         <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k))))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq0: <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
false

</span><span class="input-line" id="in24">
  (** 
  The second implication (&lt;=) is trivial and is proved by contradiction.
  More precisely, we show that the hypothesis H cannot be satisfied: with the
  tactic `use H`, we introduce in the conclusion the negation of `H` in order
  to show that it is derivable from the hypotheses (and thus obtain the
  contradiction).
  **)
  use H.</span><span class="output-line" id="out24">[&gt; Line 178: (assert ... as ) 
[goal&gt; Focused goal (1/2):
System: default
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
D0: <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span> = &lt;<span class="gn" style="color: #AA5500">nT</span>(i,k),<span class="gf" style="font-weight: bold">h</span>(<span class="gn" style="color: #AA5500">nT</span>(i,k),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))&gt;
H: not(exists (i,k:index),
         <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k))))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq0: <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))

</span><span class="input-line" id="in25"> exists i,k.</span><span class="output-line" id="out25">[&gt; Line 178: (exists i, k) 
[goal&gt; Focused goal (1/1):
System: default
Variables: i,j,k:index
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
H: not(exists (i,k:index),
         (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
          <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))
<span class="sep" style="font-weight: bold">----------------------------------------</span>
false

</span><span class="input-line" id="in26">
  (** The first implication (=&gt;) relies on the EUF assumption and is also
  proved by contradiction. **)
  use H.</span><span class="output-line" id="out26">[&gt; Line 181: (assert ... as ) 
[goal&gt; Focused goal (1/1):
System: default
Variables: i,j,k:index
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
H: not(exists (i,k:index),
         (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
          <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))

</span><span class="input-line" id="in27"> project.</span><span class="output-line" id="out27">[&gt; Line 181: project 
[goal&gt; Focused goal (1/2):
System: default/left
Variables: i,j,k:index
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
H: not(exists (i,k:index),
         (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
          <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),<span class="gn" style="color: #AA5500">key</span>(i))
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))

</span><span class="input-line" id="in28">
  (* LEFT *) euf Meq.</span><span class="output-line" id="out28">[&gt; Line 182: (euf Meq) 
[goal&gt; Focused goal (1/2):
System: default/left
Variables: i,j,k,k0:index
Clt: <span class="ga" style="color: #00AA00">T(i,k0)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
H: not(exists (i,k:index),
         (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
          <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),<span class="gn" style="color: #AA5500">key</span>(i))
Meq0: <span class="gn" style="color: #AA5500">nT</span>(i,k0) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))

</span><span class="input-line" id="in29"> by exists i,k0.</span><span class="output-line" id="out29">[&gt; Line 182: by (exists i, k0) 
[goal&gt; Focused goal (1/1):
System: default/right
Variables: i,j,k:index
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
H: not(exists (i,k:index),
         (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
          <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),<span class="gn" style="color: #AA5500">key'</span>(i,k))
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))

</span><span class="input-line" id="in30">
  (* RIGHT *) euf Meq.</span><span class="output-line" id="out30">[&gt; Line 183: (euf Meq) 
[goal&gt; Focused goal (1/1):
System: default/right
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
H: not(exists (i,k:index),
         (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
          <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))
Hap: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
Meq: <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) = <span class="gf" style="font-weight: bold">h</span>(<span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),<span class="gn" style="color: #AA5500">key'</span>(i,k))
Meq0: <span class="gn" style="color: #AA5500">nT</span>(i,k) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))

</span><span class="input-line" id="in31"> by exists i,k.</span><span class="output-line" id="out31">[&gt; Line 183: by (exists i, k) 
[goal&gt; Goal wa_R1 is proved 
</span><span class="input-line" id="in32">
Qed.</span><span class="output-line" id="out32">Exiting proof mode.


</span><span class="input-line" id="in33">

(**
We now prove an equivalence property expressing unlinkability of the protocol.
This property is expressed by the logic formula `forall t:timestamp, frame@t`
where `frame@t` is actually a bi-frame. We will have to prove that the left 
projection of `frame@t` (_i.e._ the real system) is indistinguishable from the 
right projection of `frame@t` (_i.e._ the ideal system).
**)

equiv unlinkability.</span><span class="output-line" id="out33">Goal unlinkability :
  forall t:timestamp, <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@t
</span><span class="input-line" id="in34">
(**
The high-level idea of the proof is as follows:
* if `t` corresponds to a reader's action, we show that the outcome of the 
conditional is the same on both sides and that this outcome only depends on
information already available to the attacker;
* if `t` corresponds to a tag's action, we show that the new message added 
in the frame (_i.e._ the tag's output) does not give any information to the 
attacker to distinguish the real system from the ideal one since hashes can 
intuitively be seen as fresh names thanks to the PRF cryptographic axiom.
**)
Proof.</span><span class="output-line" id="out34">[goal&gt; Focused goal (1/1):
Systems: default
Variables: t:timestamp
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(t)]
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@t


</span><span class="input-line" id="in35">
  (** The proof is done by induction over the timestamp `t`.
  The `induction` tactic also automatically introduces a case analysis over 
  all the possible values for `t`.
  The case `t = init` is trivial and automatically closed.
  The other cases correspond to the 3 different actions of the protocol. **)
  induction t.</span><span class="output-line" id="out35">[&gt; Line 211: (induction t) 
[goal&gt; Focused goal (1/3):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@<span class="ga" style="color: #00AA00">R(j)</span>


</span><span class="input-line" id="in36">

  (** Case where t = R(j).
  We start by expanding the macros and splitting the pairs. **)
  expand frame.</span><span class="output-line" id="out36">[&gt; Line 215: (expand frame) 
[goal&gt; Focused goal (1/3):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: &lt;<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>),&lt;<span class="gf" style="font-weight: bold">of_bool</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R(j)</span>),if <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R(j)</span> then <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">R(j)</span>&gt;&gt;


</span><span class="input-line" id="in37"> fa 0.</span><span class="output-line" id="out37">[&gt; Line 215: (fa 0) 
[goal&gt; Focused goal (1/3):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
1: &lt;<span class="gf" style="font-weight: bold">of_bool</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R(j)</span>),if <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R(j)</span> then <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">R(j)</span>&gt;


</span><span class="input-line" id="in38"> fa 1.</span><span class="output-line" id="out38">[&gt; Line 215: (fa 1) 
[goal&gt; Focused goal (1/3):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
1: <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R(j)</span>
2: if <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R(j)</span> then <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">R(j)</span>


</span><span class="input-line" id="in39">
  expand exec, output.</span><span class="output-line" id="out39">[&gt; Line 216: (expand exec, output) 
[goal&gt; Focused goal (1/3):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
1: <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp; <span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R(j)</span>


</span><span class="input-line" id="in40">
  (** Using the authentication goal `wa_R` previously proved, we replace the 
  formula `cond@R(j)` by an equivalent formula expressing the fact that a tag 
  `T(i,k)` has played before and that the output of this tag is the message 
  inputted by the reader. **)
  equivalent
    (cond@R(j)),
    (exists (i,k:index), T(i,k) &lt; R(j) &amp;&amp;
       fst(output@T(i,k))=fst(input@R(j)) &amp;&amp;
       snd(output@T(i,k))=snd(input@R(j))).</span><span class="output-line" id="out40">[&gt; Line 225: (equivalent cond@R(j),
             <span>exists</span> (i,k:index),
             ((T(i,k) &lt; R(j) &amp;&amp; fst(output@T(i,k)) = fst(input@R(j))) &amp;&amp;
              snd(output@T(i,k)) = snd(input@R(j))))

[goal&gt; Focused goal (1/4):
System: default
Variables: j:index
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
<span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R(j)</span>
&lt;=&gt;
exists (i,k:index),
  (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))]

</span><span class="input-line" id="in41">
  by use wa_R with j.</span><span class="output-line" id="out41">[&gt; Line 226: by (assert ... as ) 
[goal&gt; Focused goal (1/3):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>)
1: <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
   exists (i,k:index),
     (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>) &amp;&amp;
      <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))


</span><span class="input-line" id="in42">
  (** We are now able to remove this formula from the frame because the attacker
  is able to compute it using information obtained in the past. Indeed, each 
  element of this formula is already available in `frame@pred(R(j))`.
  This is done by the `fadup` tactic. **)
  by fadup 1.</span><span class="output-line" id="out42">[&gt; Line 231: by (fadup 1) 
[goal&gt; Focused goal (1/2):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@<span class="ga" style="color: #00AA00">R1(j)</span>


</span><span class="input-line" id="in43">

  (** Case where t = R1(j).
  This case is similar to the previous one. **)
  expand frame.</span><span class="output-line" id="out43">[&gt; Line 235: (expand frame) 
[goal&gt; Focused goal (1/2):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: &lt;<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>),&lt;<span class="gf" style="font-weight: bold">of_bool</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),if <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R1(j)</span> then <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">R1(j)</span>&gt;&gt;


</span><span class="input-line" id="in44"> fa 0.</span><span class="output-line" id="out44">[&gt; Line 235: (fa 0) 
[goal&gt; Focused goal (1/2):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
1: &lt;<span class="gf" style="font-weight: bold">of_bool</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R1(j)</span>),if <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R1(j)</span> then <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">R1(j)</span>&gt;


</span><span class="input-line" id="in45"> fa 1.</span><span class="output-line" id="out45">[&gt; Line 235: (fa 1) 
[goal&gt; Focused goal (1/2):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
1: <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R1(j)</span>
2: if <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@<span class="ga" style="color: #00AA00">R1(j)</span> then <span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">R1(j)</span>


</span><span class="input-line" id="in46">
  expand exec, output.</span><span class="output-line" id="out46">[&gt; Line 236: (expand exec, output) 
[goal&gt; Focused goal (1/2):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
1: <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp; <span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R1(j)</span>


</span><span class="input-line" id="in47">
  equivalent
    (cond@R1(j)),
    (not(exists (i,k:index), T(i,k) &lt; R1(j) &amp;&amp;
       fst(output@T(i,k))=fst(input@R1(j)) &amp;&amp;
       snd(output@T(i,k))=snd(input@R1(j)))).</span><span class="output-line" id="out47">[&gt; Line 241: (equivalent cond@R1(j),
             not(<span>exists</span> (i,k:index),
                 ((T(i,k) &lt; R1(j) &amp;&amp; fst(output@T(i,k)) = fst(input@R1(j)))
                  &amp;&amp; snd(output@T(i,k)) = snd(input@R1(j)))))

[goal&gt; Focused goal (1/3):
System: default
Variables: j:index
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
<span class="gm" style="font-weight: bold; color: #AA00AA">cond</span>@<span class="ga" style="color: #00AA00">R1(j)</span>
&lt;=&gt;
not(exists (i,k:index),
      (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
       <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))]

</span><span class="input-line" id="in48">
  by use wa_R1 with j.</span><span class="output-line" id="out48">[&gt; Line 242: by (assert ... as ) 
[goal&gt; Focused goal (1/2):
Systems: default
Variables: j:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">R1(j)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>)
1: <span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
   not(exists (i,k:index),
         (<span class="ga" style="color: #00AA00">T(i,k)</span> &lt; <span class="ga" style="color: #00AA00">R1(j)</span> &amp;&amp; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>) &amp;&amp;
          <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">output</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>) = <span class="gf" style="font-weight: bold">snd</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)))


</span><span class="input-line" id="in49">
  by fadup 1.</span><span class="output-line" id="out49">[&gt; Line 243: by (fadup 1) 
[goal&gt; Focused goal (1/1):
Systems: default
Variables: i,k:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@<span class="ga" style="color: #00AA00">T(i,k)</span>


</span><span class="input-line" id="in50">

  (** Case where t = T(i,k).
  We start by expanding the macros and splitting the pairs. **)
  expand frame, exec, cond, output.</span><span class="output-line" id="out50">[&gt; Line 247: (expand frame, exec, cond, output) 
[goal&gt; Focused goal (1/1):
Systems: default
Variables: i,k:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: &lt;<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>),
    &lt;<span class="gf" style="font-weight: bold">of_bool</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>) &amp;&amp; true),
     if (<span class="gm" style="font-weight: bold; color: #AA00AA">exec</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>) &amp;&amp; true) then
       &lt;<span class="gn" style="color: #AA5500">nT</span>(i,k),<span class="gf" style="font-weight: bold">h</span>(<span class="gn" style="color: #AA5500">nT</span>(i,k),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))&gt;&gt;&gt;


</span><span class="input-line" id="in51">
  fa 0; fa 1; fa 1; fa 1.</span><span class="output-line" id="out51">[&gt; Line 248: ((fa 0);((fa 1);((fa 1);(fa 1)))) 
[goal&gt; Focused goal (1/1):
Systems: default
Variables: i,k:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
1: <span class="gn" style="color: #AA5500">nT</span>(i,k)
2: <span class="gf" style="font-weight: bold">h</span>(<span class="gn" style="color: #AA5500">nT</span>(i,k),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))


</span><span class="input-line" id="in52">
  (** We now apply the `prf` tactic, in order to replace the hash by a fresh 
  name. The tactic actually replaces the hash by a conditional term in which 
  the then branch is the fresh name.
  The goal is now to prove that this condition always evaluate to `true`. **)
  prf 2.</span><span class="output-line" id="out52">[&gt; Line 253: (prf 2) 
[goal&gt; Focused goal (1/1):
Systems: default
Variables: i,k:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
1: <span class="gn" style="color: #AA5500">nT</span>(i,k)
2: if (true &amp;&amp;
       (diff(
          (forall (i0,j:index),
             (<span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))) &amp;&amp;
          forall (i0,j:index),
            (<span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)),
          (forall (i0,j,k0:index),
             (<span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt;
              (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))) &amp;&amp;
          forall (i0,j,k0:index),
            (<span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt;
             (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))) &amp;&amp;
        diff(
          forall (i0,k0:index),
            (<span class="ga" style="color: #00AA00">T(i0,k0)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gn" style="color: #AA5500">nT</span>(i0,k0)),
          forall (i0,k0:index),
            (<span class="ga" style="color: #00AA00">T(i0,k0)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gn" style="color: #AA5500">nT</span>(i0,k0)))))
     then <span class="gn" style="color: #AA5500">n_PRF</span> else <span class="gf" style="font-weight: bold">h</span>(<span class="gn" style="color: #AA5500">nT</span>(i,k),diff(<span class="gn" style="color: #AA5500">key</span>(i),<span class="gn" style="color: #AA5500">key'</span>(i,k)))


</span><span class="input-line" id="in53">
  yesif 2.</span><span class="output-line" id="out53">[&gt; Line 254: (yesif 2) 
[goal&gt; Focused goal (1/2):
System: default
Variables: i,k:index
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
diff(
  (forall (i0,j:index),
     (<span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))) &amp;&amp;
  forall (i0,j:index),
    (<span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)),
  (forall (i0,j,k0:index),
     (<span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))) &amp;&amp;
  forall (i0,j,k0:index),
    (<span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))) &amp;&amp;
diff(
  forall (i0,k0:index), (<span class="ga" style="color: #00AA00">T(i0,k0)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gn" style="color: #AA5500">nT</span>(i0,k0)),
  forall (i0,k0:index),
    (<span class="ga" style="color: #00AA00">T(i0,k0)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gn" style="color: #AA5500">nT</span>(i0,k0)))

</span><span class="input-line" id="in54"> help project.</span><span class="output-line" id="out54">[&gt; Line 254: (help project) 

- <span class="hf" style="font-weight: bold; color: #AA00AA">project</span> -
    Turn a goal on a bi-system into one goal for each projection of the
    bi-system. 
     
    This tactic will project all occurrences of diff operators in local
    formulas.
     
    Usage: project   


[goal&gt; Focused goal (1/2):
System: default
Variables: i,k:index
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
diff(
  (forall (i0,j:index),
     (<span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))) &amp;&amp;
  forall (i0,j:index),
    (<span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)),
  (forall (i0,j,k0:index),
     (<span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))) &amp;&amp;
  forall (i0,j,k0:index),
    (<span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))) &amp;&amp;
diff(
  forall (i0,k0:index), (<span class="ga" style="color: #00AA00">T(i0,k0)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gn" style="color: #AA5500">nT</span>(i0,k0)),
  forall (i0,k0:index),
    (<span class="ga" style="color: #00AA00">T(i0,k0)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gn" style="color: #AA5500">nT</span>(i0,k0)))

</span><span class="input-line" id="in55">
  (** We now project the bi-system into one goal for the left projection and
  one goal for the right projection. Note that the 3rd conjuct (the one with
  `nT(i,k) &lt;&gt; nT(i0,k0)`) is automatically simplified by Squirrel, using the
  fact that names with different indices cannot be equal. **)
  project.</span><span class="output-line" id="out55">[&gt; Line 259: project 
[goal&gt; Focused goal (1/3):
System: default/left
Variables: i,k:index
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
(forall (i0,j:index), (<span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))) &amp;&amp;
forall (i0,j:index),
  (<span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; i = i0 =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))

</span><span class="input-line" id="in56">
  (** The proof is the same on both sides.
  We first split the conjunction in the conclusion and then have to show that 
  the equality `nT(i,k) = fst(input@R(j))` is impossible. Here, the `fresh` 
  tactic allows to conclude because `nT(i,k)` is freshly generated at each new
  session of a tag, and since `R(j) &lt; T(i,k)` we know that the equality cannot 
  hold. **)
  split.</span><span class="output-line" id="out56">[&gt; Line 266: split 
[goal&gt; Focused goal (1/4):
System: default/left
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>))
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)
Meq: <span class="gn" style="color: #AA5500">nT</span>(i,k) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
false

</span><span class="input-line" id="in57"> by fresh Meq.</span><span class="output-line" id="out57">[&gt; Line 266: by (fresh Meq) 
[goal&gt; Focused goal (1/3):
System: default/left
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)
Meq: <span class="gn" style="color: #AA5500">nT</span>(i,k) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
false

</span><span class="input-line" id="in58"> by fresh Meq.</span><span class="output-line" id="out58">[&gt; Line 266: by (fresh Meq) 
[goal&gt; Focused goal (1/2):
System: default/right
Variables: i,k:index
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
(forall (i0,j,k0:index),
   (<span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>))) &amp;&amp;
forall (i0,j,k0:index),
  (<span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i = i0 &amp;&amp; k = k0) =&gt; <span class="gn" style="color: #AA5500">nT</span>(i,k) &lt;&gt; <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>))

</span><span class="input-line" id="in59">
  split.</span><span class="output-line" id="out59">[&gt; Line 267: split 
[goal&gt; Focused goal (1/3):
System: default/right
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">R(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R(j)</span>))
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)
Meq: <span class="gn" style="color: #AA5500">nT</span>(i,k) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
false

</span><span class="input-line" id="in60"> by fresh Meq.</span><span class="output-line" id="out60">[&gt; Line 267: by (fresh Meq) 
[goal&gt; Focused goal (1/2):
System: default/right
Variables: i,j,k:index
Clt: <span class="ga" style="color: #00AA00">R1(j)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span>
D: <span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span> = <span class="gf" style="font-weight: bold">att</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">R1(j)</span>))
H: <span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)
Meq: <span class="gn" style="color: #AA5500">nT</span>(i,k) = <span class="gf" style="font-weight: bold">fst</span>(<span class="gm" style="font-weight: bold; color: #AA00AA">input</span>@<span class="ga" style="color: #00AA00">R1(j)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
false

</span><span class="input-line" id="in61"> by fresh Meq.</span><span class="output-line" id="out61">[&gt; Line 267: by (fresh Meq) 
[goal&gt; Focused goal (1/1):
Systems: default
Variables: i,k:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
1: <span class="gn" style="color: #AA5500">nT</span>(i,k)
2: <span class="gn" style="color: #AA5500">n_PRF</span>


</span><span class="input-line" id="in62">
  (** We have now replaced the hash by a fresh name occurring nowhere else, 
  so we can remove it using the `fresh` tactic. **)
  fresh 2.</span><span class="output-line" id="out62">[&gt; Line 270: (fresh 2) 
[goal&gt; Focused goal (1/1):
Systems: default
Variables: i,k:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
1: <span class="gn" style="color: #AA5500">nT</span>(i,k)


</span><span class="input-line" id="in63">
  (** We can also remove the name `nT(i,k)`, and conclude by induction
  hypothesis. **)
  fresh 1.</span><span class="output-line" id="out63">[&gt; Line 273: (fresh 1) 
[goal&gt; Focused goal (1/1):
Systems: default
Variables: i,k:index
H: [<span class="gm" style="font-weight: bold; color: #AA00AA">happens</span>(<span class="ga" style="color: #00AA00">T(i,k)</span>)]
IH: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
<span class="sep" style="font-weight: bold">----------------------------------------</span>
0: <span class="gm" style="font-weight: bold; color: #AA00AA">frame</span>@pred(<span class="ga" style="color: #00AA00">T(i,k)</span>)
1: if (forall (i0,k0:index), (<span class="ga" style="color: #00AA00">T(i0,k0)</span> &lt; <span class="ga" style="color: #00AA00">T(i,k)</span> =&gt; (i0 &lt;&gt; i || k0 &lt;&gt; k)))
     then <span class="gf" style="font-weight: bold">zero</span> else <span class="gn" style="color: #AA5500">nT</span>(i,k)


</span><span class="input-line" id="in64"> by yesif 1.</span><span class="output-line" id="out64">[&gt; Line 273: by (yesif 1) 
[goal&gt; Goal unlinkability is proved 
</span><span class="input-line" id="in65">
Qed.</span><span class="output-line" id="out65">Exiting proof mode.


</span></span>
<h1 id="about-this-tutorial">Example</h1>
<div class="example-left">
  <div class="example-buttons">
    <button type="button" class="command" onclick="goto_down()">-</button>
    <button type="button" class="command" onclick="goto_selected()">=></button>
    <button type="button" class="command" onclick="goto_up()">+</button>
    <button type="button" class="command" style="float: right;">doc</button>
  </div>
  <div class="example-code" style="height: 650px;	border-style: none solid solid solid;"><span id="in-line"></span></div>
</div>
<div class="example-left">
  <div class="example-code" style="height: 300px;	border-style: solid solid double none;"><span>Previously:</span>
<span id="prec-line"></span>
  </div>
  <div class="example-code" style="height: 400px;	border-style: none solid solid none;"><span id="out-line"></span></div>
</div>

<script src="script.js"></script>

</body>

